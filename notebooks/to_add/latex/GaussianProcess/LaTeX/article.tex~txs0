%%%%%%%%%%%%%%%%%%%%%%% file typeinst.tex %%%%%%%%%%%%%%%%%%%%%%%%%
%
% This is the LaTeX source for the instructions to authors using
% the LaTeX document class 'llncs.cls' for contributions to
% the Lecture Notes in Computer Sciences series.
% http://www.springer.com/lncs       Springer Heidelberg 2006/05/04
%
% It may be used as a template for your own input - copy it
% to a new file with a new name and use it as the basis
% for your article.
%
% NB: the document class 'llncs' has its own and detailed documentation, see
% ftp://ftp.springer.de/data/pubftp/pub/tex/latex/llncs/latex2e/llncsdoc.pdf
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\documentclass[runningheads,a4paper]{llncs}

\usepackage{amssymb}
\setcounter{tocdepth}{3}
\usepackage{graphicx}

\usepackage{tikz}
\usetikzlibrary{positioning,arrows,shapes.geometric,
    matrix,shapes.symbols,decorations.pathreplacing}

\usepackage{subcaption}
\captionsetup{compatibility=false}

\usepackage{booktabs}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}

\usepackage{url}
\urldef{\mailsa}\path|loic_tetrel@yahoo.fr|
%\urldef{\mailsb}\path|acen.chebrek@gmail.com|
\urldef{\mailsc}\path|catherine.laporte@etsmtl.ca|
\urldef{\mailsanon}\path|******@*******.***|
\newcommand{\keywords}[1]{\par\addvspace\baselineskip
\noindent\keywordname\enspace\ignorespaces#1}

\begin{document}

\mainmatter  % start of an individual contribution

% first the title is needed
% CL: le titre original me semble un peu long.  Et tant qu'a faire 2 lignes, utilisons le mot entier "Ultrasound" plutot qu'une abreviation.
%\title{Learning to improve Graph-Based Estimation of Probe Trajectory for Sensorless Freehand 3D US}
\title{Learning for Graph-Based Sensorless Freehand 3D Ultrasound}

% a short form should be given in case it is too long for the running head
\titlerunning{Graph-Based Sensorless Freehand 3D US}%
%\titlerunning{Estimation of Probe Trajectory %of Probe Motion 
%for Sensorless Freehand 3D US}% reconstruction}%Reconstruction of the probe motion for freehand 3D US}

% the name(s) of the author(s) follow(s) next
%
% NB: Chinese authors should write their first names(s) in front of
% their surnames. This ensures that the names appear correctly in
% the running heads and the author index.
%
% CL: a decommenter pour la version finale non-anonymisee
\author{Loïc Tetrel, Hacène Chebrek and Catherine Laporte}
%\author{**********************************}
%
%\authorrunning{Estimation of Probe Trajectory %of Probe Motion 
%for Sensorless Freehand 3D US}
\authorrunning{Graph-Based Sensorless Freehand 3D US
}
% (feature abused for this document to repeat the title also on left hand pages)

% the affiliations are given next; don't give your e-mail address
% unless you accept that it will be published
%\institute{******************************************\\
\institute{Dept. of Electrical Engineering, École de technologie supérieure, Montreal, Canada\\
1100 Rue Notre-Dame O, Montréal, QC H3C 1K3, Canada\\
%CL: a modifier pour la version finale non-anonymisee
%\mailsa\\,\mailsb,\mailsc\\
\mailsa, \mailsc\\
%\mailsanon\\
\url{}}

%
% NB: a more complex sample for affiliations and the mapping to the
% corresponding authors can be found in the file "llncs.dem"
% (search for the string "\mainmatter" where a contribution starts).
% "llncs.dem" accompanies the document class "llncs.cls".
%

\toctitle{Learning for Graph-Based Sensorless Freehand 3D Ultrasound}
%Estimation of Probe Trajectory %of Probe Motion 
%for Sensorless Freehand 3D US}%of Probe Motion for Freehand 3D US}
\maketitle


\begin{abstract}
Sensorless freehand 3D ultrasound (US) uses speckle decorrelation to estimate small rigid motions between pairs of 2D images. %without a position sensor.
Trajectory estimation combines these motion estimates to obtain the position each image relative to the first.  This is prone to the accumulation of measurement bias. %es in the motion estimates.
%As an effect of accumulating estimation's biases, the error if full at the end of the acquisition.
Whereas previous work concentrated on correcting biases at the source, this paper proposes to reduce error accumulation by carefully choosing the set of measurements used for trajectory estimation.
%an additional approach which consist in choosing the least prone to accumulating bias motions to associate.
An undirected graph is created with frames as vertices and motion measurements as edges.
Using constrained shortest paths in the graph, random trajectories are generated and averaged to obtain trajectory estimate and uncertainty.
To improve accuracy, a Gaussian process regressor is trained on tracked US sequences to predict systematic motion measurement error, which is then used to weigh the edges of the graph.  
%with a final averaging giving the best trajectory reconstruction and a measure of uncertainty.
Results on speckle phantom imagery %for monotonic trajectory 
show %a significant reduction in mean target registration error of the 
significantly improved trajectory estimates in comparison with the state-of-the-art, promising accurate volumetric reconstruction.
\keywords{Freehand 3D ultrasound; Speckle decorrelation; Sensorless reconstruction; Measurement selection; Gaussian process regression}
\end{abstract}

\section{Introduction}\label{introduction}

Compared to traditional 2D ultrasound (US), 3D US allows a better evaluation of the anatomical structures. A 3D probe can be used to obtain US volumes, but it is expensive and offers a limited field of view. %is limited by the width of the probe. 
%With conventionnal material, 
Using freehand 3D US with a conventional 2D probe, the sonographer sweeps the area of interest to acquire a sequence of 2D frames. Volume reconstruction of this sequence requires the six degree of freedom (6DoF) motions of all the frames %(3D translations and rotation) 
relative to the first one. During the acquisition, the probe can be tracked by a position sensor, but this imposes extra cost, is cumbersome and requires calibration. Instead, using the information of the images themselves to perform a sensorless registration of the frames \cite{afsham2015nonlocal,chen1997determination,conrath2012towards,housden2007sensorless,tuthill1998automated} allows easy and inexpensive transducer tracking.\par
This is possible because speckle patterns are correlated out-of-plane in nearby images. Under Rayleigh scattering conditions, this phenomenon is entirely predictable from transducer characteristics and can be used to measure elevational displacement~\cite{chen1997determination}.
%they related the second order statistic of the speckle to the elevational displacement of the probe in a decorrelation-curve \cite{chen1997determination}. 
This approach can be adapted to work outside Rayleigh scattering conditions, allowing measurements in imagery of real tissues~\cite{gee2006sensorless,laporte2011learning,afsham2015nonlocal}. In-plane displacement can be estimated from the position of the correlation peak.  %To retrieve 6DoF  motion, 
%the image is 
By dividing the image into patches, each with a local 3D displacement estimate, the global 6DoF rigid motion can be estimated by a least squares approach~\cite{tuthill1998automated}.\par
%However, in freehand 3D US, 
Freehand motion does not produce pure elevational translations. Unfortunately, other types of motion (particularly rotations), also affect speckle correlation, 
%The other 6DoF parameters affect speckle-correlation which 
leading to biased %elevational translations 
motion estimates~\cite{li2002tissue}. %In particular, rotations of the probe has much impact on the decorrelation curve because there is a curvature in the direction of wave’s propagation \cite{kallel1994speckle}. 
%Because the elevation estimate does not give sign, problems occurs when the probe trajectory is not monotonic and the frames are intersecting \cite{housden2007sensorless,laporte2008combinatorial}.
Moreover, elevational translation measurements are limited by speckle correlation range, so we need to combine multiple measurements to estimate each frame's position relative to the first~\cite{housden2007sensorless}. This results in the accumulation of bias and strongly affects the accuracy of the trajectory estimate. This is the challenge addressed in this paper.\par
%To simplify the problem we assumed that the transducer does not move in-plane, we are considering a monotonic movement neither the intersection between two frames, and we are under Rayleigh scattering.\par
A few papers proposed to correct measurement biases at the source. Correction of the elevational decorrelation curve was proposed to increase accuracy under probe
rotation~\cite{afsham2014generalized,housden2008rotational}.  It was also suggested that 
because the measurement biases are systematic, corrections can be learned from tracked synthetic image sequences to improve the accuracy of sensorless motion estimation~\cite{conrath2012towards}. %\cite{conrath2012towards}. 
However, we found this approach difficult to generalize to real imagery.\par
%But the complexity of the scattering condition in real imagery is not well modelled with synthetic images.
%Looking at the patches of the images, other extracted the elevationnal sign working with TSP \cite{laporte2008combinatorial} or RANSAC algorithm \cite{housden2007sensorless}. 
Our approach to the problem is to reduce error accumulation by carefully selecting the measurements used for trajectory estimation.  For this purpose, %Housden et al.
previous work has
%Other approaches have 
%focused on the correction of the error's accumulation 
proposed %reducing error accumulation by 
using %the most 
maximally spaced images (thereby reducing the number of error accumulation steps)~\cite{housden2007sensorless}, or fusing multiple redundant elevational motion estimates along with measurements of their uncertainty~\cite{laporte2008combinatorial}. A hypothesis testing approach was also proposed to eliminate biased measurements arising from inaccurate tissue models used outside Rayleigh scattering conditions~\cite{laporte10}. None of these works considered
%but they did not %focused in the choose 
%consider the choice of 
how to choose the \emph{best} motion estimates for trajectory estimate.\par
%The use of spaning tree \cite{zhu2016automatic} is also studied but in freehand 3D US it affects the reconstruction accuracy.\par

\section{Conclusion}
\label{sec:conclusion}
This paper shows that measurement error can effectively be learned from tracked data and used towards improved sensorless freehand 3D US reconstruction.  
%the importance of measurement selection in sensorless freehand 3D US. We introduced a new 
Our error weighted graph-based method %based on a graph generating an accurate reconstruction 
%taking into account measurement quality 
%that 
significantly improves over the state-of-the-art. 
%On average, we achieve a mTRE lower than $5$ mm over sequences longer than $20$ mm. 
Future work will concentrate on adapting our method to %the case of 
non-Rayleigh scattering conditions. %and quantitative results of volumetric reconstruction.
%We prove that the accumulation of error has to be controlled (see the results of NN and CSq) and that choosing more wisely the motions affects the result ($p=0.004$). 
%Our contribution start to be significant from the last $35$ frames of each acquisition which correspond to long acquisition at least $\sim25$ mm width. In average on all the acquisition, the mTRE is lower than $5$ mm which is really encouraging for sensorless 3D reconstruction knowing our real freehand motion (lot of rotations and translations).
%Future work will concentrate in the problematic of real tissue where we think will lead to better results (because it is easier to qualify a good registration in this context).
%The averaging algorithm can be extended to any work leading in the search of shortest path in a graph and improve the result for wide graph.

% CL: a de-commenter pour la version finale non-anonymisee
%\subsection*{Acknowledgment}
%This work was funded by a grant from NSERC.

{\small
\bibliographystyle{splncs03}
\bibliography{article}
}

\end{document}

